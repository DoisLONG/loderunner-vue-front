{"remainingRequest":"/Users/daocloud_j/git/loderunner-vue-front/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/daocloud_j/git/loderunner-vue-front/src/views/Cart.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/daocloud_j/git/loderunner-vue-front/src/views/Cart.vue","mtime":1591819548000},{"path":"/Users/daocloud_j/git/loderunner-vue-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/daocloud_j/git/loderunner-vue-front/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/daocloud_j/git/loderunner-vue-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/daocloud_j/git/loderunner-vue-front/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IFRvYXN0IH0gZnJvbSAndmFudCcKaW1wb3J0IG5hdkJhciBmcm9tICdAL2NvbXBvbmVudHMvTmF2QmFyJwppbXBvcnQgc0hlYWRlciBmcm9tICdAL2NvbXBvbmVudHMvU2ltcGxlSGVhZGVyJwppbXBvcnQgeyBnZXRDYXJ0LCBkZWxldGVDYXJ0SXRlbSwgbW9kaWZ5Q2FydCB9IGZyb20gJy4uL3NlcnZpY2UvY2FydCcKZXhwb3J0IGRlZmF1bHQgewogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBjaGVja2VkOiBmYWxzZSwKICAgICAgbGlzdDogW10sCiAgICAgIGFsbDogZmFsc2UsCiAgICAgIHJlc3VsdDogW10sCiAgICAgIGNoZWNrQWxsOiB0cnVlCiAgICB9CiAgfSwKICBjb21wb25lbnRzOiB7CiAgICBuYXZCYXIsCiAgICBzSGVhZGVyCiAgfSwKICBtb3VudGVkKCkgewogICAgdGhpcy5pbml0KCkKICB9LAogIGNvbXB1dGVkOiB7CiAgICB0b3RhbDogZnVuY3Rpb24oKSB7CiAgICAgIGxldCBzdW0gPSAwCiAgICAgIGxldCBfbGlzdCA9IHRoaXMubGlzdC5maWx0ZXIoaXRlbSA9PiB0aGlzLnJlc3VsdC5pbmNsdWRlcyhpdGVtLmNhcnRJdGVtSWQpKQogICAgICBfbGlzdC5mb3JFYWNoKGl0ZW0gPT4gewogICAgICAgIHN1bSArPSBpdGVtLmdvb2RzQ291bnQgKiBpdGVtLnNlbGxpbmdQcmljZQogICAgICB9KQogICAgICByZXR1cm4gc3VtCiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBhc3luYyBpbml0KCkgewogICAgICBUb2FzdC5sb2FkaW5nKHsgbWVzc2FnZTogJ+WKoOi9veS4rS4uLicsIGZvcmJpZENsaWNrOiB0cnVlIH0pOwogICAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IGdldENhcnQoeyBwYWdlTnVtYmVyOiAxIH0pCiAgICAgIHRoaXMubGlzdCA9IGRhdGEKICAgICAgdGhpcy5yZXN1bHQgPSBkYXRhLm1hcChpdGVtID0+IGl0ZW0uY2FydEl0ZW1JZCkKICAgICAgVG9hc3QuY2xlYXIoKQogICAgfSwKICAgIGdvQmFjaygpIHsKICAgICAgdGhpcy4kcm91dGVyLmdvKC0xKQogICAgfSwKICAgIGdvVG8oKSB7CiAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsgcGF0aDogJ2hvbWUnIH0pCiAgICB9LAogICAgYXN5bmMgb25DaGFuZ2UodmFsdWUsIGRldGFpbCkgewogICAgICBpZiAodGhpcy5saXN0LmZpbHRlcihpdGVtID0+IGl0ZW0uY2FydEl0ZW1JZCA9PSBkZXRhaWwubmFtZSlbMF0uZ29vZHNDb3VudCA9PSB2YWx1ZSkgcmV0dXJuCiAgICAgIFRvYXN0LmxvYWRpbmcoeyBtZXNzYWdlOiAn5L+u5pS55LitLi4uJywgZm9yYmlkQ2xpY2s6IHRydWUgfSk7CiAgICAgIGNvbnN0IHBhcmFtcyA9IHsKICAgICAgICBjYXJ0SXRlbUlkOiBkZXRhaWwubmFtZSwKICAgICAgICBnb29kc0NvdW50OiB2YWx1ZQogICAgICB9CiAgICAgIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgbW9kaWZ5Q2FydChwYXJhbXMpCiAgICAgIHRoaXMubGlzdC5mb3JFYWNoKGl0ZW0gPT4gewogICAgICAgIGlmIChpdGVtLmNhcnRJdGVtSWQgPT0gZGV0YWlsLm5hbWUpIHsKICAgICAgICAgIGl0ZW0uZ29vZHNDb3VudCA9IHZhbHVlCiAgICAgICAgfQogICAgICB9KQogICAgICBUb2FzdC5jbGVhcigpOwogICAgfSwKICAgIGFzeW5jIG9uU3VibWl0KCkgewogICAgICBjb25zdCBwYXJhbXMgPSBKU09OLnN0cmluZ2lmeSh0aGlzLnJlc3VsdCkKICAgICAgLy8gZm9yKGxldCBpID0gMDsgaSA8IHRoaXMucmVzdWx0Lmxlbmd0aDsgaSsrKSB7CiAgICAgIC8vICAgYXdhaXQgZGVsZXRlQ2FydEl0ZW0odGhpcy5yZXN1bHRbaV0pCiAgICAgIC8vIH0KICAgICAgdGhpcy4kcm91dGVyLnB1c2goeyBwYXRoOiBgY3JlYXRlLW9yZGVyP2NhcnRJdGVtSWRzPSR7cGFyYW1zfWAgfSkKICAgIH0sCiAgICBhc3luYyBkZWxldGVHb29kKGlkKSB7CiAgICAgIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgZGVsZXRlQ2FydEl0ZW0oaWQpCiAgICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCd1cGRhdGVDYXJ0JykKICAgICAgdGhpcy5pbml0KCkKICAgIH0sCiAgICBncm91cENoYW5nZShyZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdC5sZW5ndGggPT0gdGhpcy5saXN0Lmxlbmd0aCkgewogICAgICAgIHRoaXMuY2hlY2tBbGwgPSB0cnVlCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5jaGVja0FsbCA9IGZhbHNlCiAgICAgIH0KICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQKICAgIH0sCiAgICBhbGxDaGVjayh2YWx1ZSkgewogICAgICBpZiAoIXRoaXMuY2hlY2tBbGwpIHsKICAgICAgICB0aGlzLnJlc3VsdCA9IHRoaXMubGlzdC5tYXAoaXRlbSA9PiBpdGVtLmNhcnRJdGVtSWQpCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSBbXQogICAgICB9CiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["Cart.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Cart.vue","sourceRoot":"src/views","sourcesContent":["<!--\n * 严肃声明：\n * 开源版本请务必保留此注释头信息，若删除我方将保留所有法律责任追究！\n * 本系统已申请软件著作权，受国家版权局知识产权以及国家计算机软件著作权保护！\n * 可正常分享和学习源码，不得用于违法犯罪活动，违者必究！\n * Copyright (c) 2020 陈尼克 all rights reserved.\n * 版权所有，侵权必究！\n *\n-->\n\n<template>\n  <div class=\"cart-box\">\n    <s-header :name=\"'购物车'\"></s-header>\n    <div class=\"cart-body\">\n      <van-checkbox-group @change=\"groupChange\" v-model=\"result\" ref=\"checkboxGroup\">\n        <van-swipe-cell :right-width=\"50\" v-for=\"(item, index) in list\" :key=\"index\">\n          <div class=\"good-item\">\n            <van-checkbox :name=\"item.cartItemId\" />\n            <div class=\"good-img\"><img :src=\"`//api.newbee.ltd${item.goodsCoverImg}`\" alt=\"\"></div>\n            <div class=\"good-desc\">\n              <div class=\"good-title\">\n                <span>{{ item.goodsName }}</span>\n                <span>x{{ item.goodsCount }}</span>\n              </div>\n              <div class=\"good-btn\">\n                <div class=\"price\">¥{{ item.sellingPrice }}</div>\n                <van-stepper\n                  integer\n                  :min=\"1\"\n                  :value=\"item.goodsCount\"\n                  :name=\"item.cartItemId\"\n                  async-change\n                  @change=\"onChange\"\n                />\n              </div>\n            </div>\n          </div>\n          <van-button\n            slot=\"right\"\n            square\n            icon=\"delete\"\n            type=\"danger\"\n            class=\"delete-button\"\n            @click=\"deleteGood(item.cartItemId)\"\n          />\n        </van-swipe-cell>\n      </van-checkbox-group>\n    </div>\n    <van-submit-bar\n      v-if=\"list.length > 0\"\n      class=\"submit-all\"\n      :price=\"total * 100\"\n      button-text=\"结算\"\n      @submit=\"onSubmit\"\n    >\n      <van-checkbox @click=\"allCheck\" v-model=\"checkAll\">全选</van-checkbox>\n    </van-submit-bar>\n    <div class=\"empty\" v-if=\"!list.length\">\n      <van-icon name=\"smile-o\" />\n      <div class=\"title\">购物车空空空如也</div>\n      <van-button color=\"#1baeae\" type=\"primary\" @click=\"goTo\" block>前往首页</van-button>\n    </div>\n    <nav-bar></nav-bar>\n  </div>\n</template>\n\n<script>\nimport { Toast } from 'vant'\nimport navBar from '@/components/NavBar'\nimport sHeader from '@/components/SimpleHeader'\nimport { getCart, deleteCartItem, modifyCart } from '../service/cart'\nexport default {\n  data() {\n    return {\n      checked: false,\n      list: [],\n      all: false,\n      result: [],\n      checkAll: true\n    }\n  },\n  components: {\n    navBar,\n    sHeader\n  },\n  mounted() {\n    this.init()\n  },\n  computed: {\n    total: function() {\n      let sum = 0\n      let _list = this.list.filter(item => this.result.includes(item.cartItemId))\n      _list.forEach(item => {\n        sum += item.goodsCount * item.sellingPrice\n      })\n      return sum\n    }\n  },\n  methods: {\n    async init() {\n      Toast.loading({ message: '加载中...', forbidClick: true });\n      const { data } = await getCart({ pageNumber: 1 })\n      this.list = data\n      this.result = data.map(item => item.cartItemId)\n      Toast.clear()\n    },\n    goBack() {\n      this.$router.go(-1)\n    },\n    goTo() {\n      this.$router.push({ path: 'home' })\n    },\n    async onChange(value, detail) {\n      if (this.list.filter(item => item.cartItemId == detail.name)[0].goodsCount == value) return\n      Toast.loading({ message: '修改中...', forbidClick: true });\n      const params = {\n        cartItemId: detail.name,\n        goodsCount: value\n      }\n      const { data } = await modifyCart(params)\n      this.list.forEach(item => {\n        if (item.cartItemId == detail.name) {\n          item.goodsCount = value\n        }\n      })\n      Toast.clear();\n    },\n    async onSubmit() {\n      const params = JSON.stringify(this.result)\n      // for(let i = 0; i < this.result.length; i++) {\n      //   await deleteCartItem(this.result[i])\n      // }\n      this.$router.push({ path: `create-order?cartItemIds=${params}` })\n    },\n    async deleteGood(id) {\n      const { data } = await deleteCartItem(id)\n      this.$store.dispatch('updateCart')\n      this.init()\n    },\n    groupChange(result) {\n      if (result.length == this.list.length) {\n        this.checkAll = true\n      } else {\n        this.checkAll = false\n      }\n      this.result = result\n    },\n    allCheck(value) {\n      if (!this.checkAll) {\n        this.result = this.list.map(item => item.cartItemId)\n      } else {\n        this.result = []\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"less\">\n  @import '../common/style/mixin';\n  .cart-box {\n    .cart-header {\n      position: fixed;\n      top: 0;\n      left: 0;\n      z-index: 10000;\n      .fj();\n      .wh(100%, 44px);\n      line-height: 44px;\n      padding: 0 10px;\n      .boxSizing();\n      color: #252525;\n      background: #fff;\n      border-bottom: 1px solid #dcdcdc;\n      .cart-name {\n        font-size: 14px;\n      }\n    }\n    .cart-body {\n      margin: 60px 0 100px 0;\n      padding-left: 10px;\n      .good-item {\n        display: flex;\n        .good-img {\n          img {\n            .wh(100px, 100px)\n          }\n        }\n        .good-desc {\n          display: flex;\n          flex-direction: column;\n          justify-content: space-between;\n          flex: 1;\n          padding: 20px;\n          .good-title {\n            display: flex;\n            justify-content: space-between;\n          }\n          .good-btn {\n            display: flex;\n            justify-content: space-between;\n            .price {\n              font-size: 16px;\n              color: red;\n              line-height: 28px;\n            }\n            .van-icon-delete {\n              font-size: 20px;\n              margin-top: 4px;\n            }\n          }\n        }\n      }\n      .delete-button {\n        width: 50px;\n        height: 100%;\n      }\n    }\n    .empty {\n      width: 50%;\n      margin: 0 auto;\n      text-align: center;\n      margin-top: 200px;\n      .van-icon-smile-o {\n        font-size: 50px;\n      }\n      .title {\n        font-size: 16px;\n        margin-bottom: 20px;\n      }\n    }\n    .submit-all {\n      margin-bottom: 50px;\n      .van-checkbox {\n        margin-left: 10px\n      }\n      .van-submit-bar__text {\n        margin-right: 10px\n      }\n      .van-submit-bar__button {\n        background: @primary;\n      }\n    }\n    .van-checkbox__icon--checked .van-icon {\n      background-color: @primary;\n      border-color: @primary;\n    }\n  }\n</style>\n"]}]}